<!DOCTYPE html>
<html lang="ja">

<head>
  <title>Lua VM | ドキュメント | Essh - Extended ssh command</title>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

  <link rel="shortcut icon" href="/essh/images/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/agate.min.css">
<link rel="stylesheet" href="/essh/asciinema/asciinema-player.css">
<link rel="stylesheet" href="/essh/css/style.css">

</head>

<body class="layout-docs-single">
  <nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
      <a class="navbar-brand" href="/essh/">Essh</a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a class="" href="/essh/intro/en/index.html">Intro</a>
        </li>
        <li>
          <a class="" href="/essh/docs/en/index.html">Docs</a>
        </li>
        <li>
          <a class="" href="https://github.com/kohkimakimoto/essh">Github</a>
        </li>
        <li>
          <a class="" href="https://github.com/kohkimakimoto/essh/releases/latest">Download</a>
        </li>

      </ul>
    </div>
  </div>
</nav>

  <section class="single content-wrapper">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 col-sm-push-3">
          <div class="pull-right lang-list change-lang">
            <span>言語の選択:</span>
            <ul>
              <li><a href="/essh/docs/en/lua-vm.html" class="">英語</a></li>
              <li><a href="/essh/docs/ja/lua-vm.html" class="disabled">日本語</a></li>
            </ul>
            </div>
          <section class="main-content">
            

<h1 id="lua-vm">Lua VM</h1>

<p>EsshはLuaで書かれた設定ファイルを読み込むために<a href="https://github.com/yuin/gopher-lua">GopherLua</a>をLua VMとして使っています。</p>

<h2 id="ビルトイン関数">ビルトイン関数</h2>

<p>すでに<code>host</code>と<code>task</code>関数を見てきたように、Esshのコア機能はビルトイン関数で構成されています。Esshが提供しているすべての関数は以下の通りです。</p>

<ul>
<li><p><code>host</code>: ホストを定義します。<a href="/essh/docs/ja/hosts.html">ホスト</a>を参照してください。</p></li>

<li><p><code>task</code>: タスクを定義します。<a href="/essh/docs/ja/tasks.html">タスク</a>を参照してください。</p></li>

<li><p><code>driver</code>: ドライバを定義します。<a href="/essh/docs/ja/drivers.html">ドライバ</a>を参照してください。</p></li>
</ul>

<h2 id="ビルトインライブラリ">ビルトインライブラリ</h2>

<p>Esshには、設定ファイルで使用できるビルトインLuaライブラリが用意されています。
たとえば、<code>json</code>ライブラリを使いたい場合は、以下のようにLuaの<code>require</code>関数を使います。</p>

<pre><code class="language-lua">local json = require(&quot;json&quot;)

local jsontext = json.encode({aaa = &quot;bbb&quot;, ccc = &quot;ddd&quot;})
print(jsontext)
</code></pre>

<p>以下は、Esshに組み込まれているビルトインライブラリです。</p>

<ul>
<li><code>json</code>: <a href="https://github.com/layeh/gopher-json">layeh/gopher-json</a>.</li>
<li><code>fs</code>: <a href="https://github.com/kohkimakimoto/gluafs">kohkimakimoto/gluafs</a>.</li>
<li><code>yaml</code>: <a href="https://github.com/kohkimakimoto/gluayaml">kohkimakimoto/gluayaml</a>.</li>
<li><code>question</code>: <a href="https://github.com/kohkimakimoto/gluaquestion">kohkimakimoto/gluaquestion</a>.</li>
<li><code>template</code>: <a href="https://github.com/kohkimakimoto/gluatemplate">kohkimakimoto/gluatemplate</a>.</li>
<li><code>env</code>: <a href="https://github.com/kohkimakimoto/gluaenv">kohkimakimoto/gluaenv</a>.</li>
<li><code>http</code>: <a href="https://github.com/cjoudrey/gluahttp">cjoudrey/gluahttp</a>.</li>
<li><code>re</code>: <a href="https://github.com/yuin/gluare">yuin/gluare</a></li>
<li><code>sh</code>: <a href="https://github.com/otm/gluash">otm/gluash</a></li>
</ul>

<h2 id="定義済みの変数">定義済みの変数</h2>

<p>Esshは事前定義された変数を提供します。 最新のEsshのバージョンには、定義済みの変数が1つあります。<code>essh</code>です。</p>

<p><code>essh</code>はいくつかの関数と変数を持つテーブルです。下記を参照してください</p>

<ul>
<li><p><code>ssh_config</code> (string): ssh_configはssh_configファイルのパスです。デフォルトでは、Esshを実行すると自動的に生成される一時ファイルです。 ssh_configを静的な宛先に生成するために、この値を上書きすることができます。クライアントコンピュータとターゲットサーバの間のサーバであるゲートウェイホストを使用する場合は、この変数を使用して <code>ProxyCommand</code>を指定することができます。以下の例を参照してください：</p>

<pre><code class="language-lua">--
-- network environment.
-- [your-computer] -- [getway-server1] -- [web-server]
--

host &quot;web-server&quot; {
    HostName = &quot;192.168.0.1&quot;,
    ProxyCommand = &quot;ssh -q -F &quot; .. essh.ssh_config .. &quot; -W %h:%p getway-server1&quot;,
}
</code></pre></li>

<li><p><code>select_hosts</code> (function): 定義されたホストを取得します。これは、ホスト設定のオーバライドやデフォルト値の設定に役立ちます。たとえば、デフォルトのssh_config:<code>ForwardAgent = yes</code>を設定する場合は、以下のコードで実施できます。</p>

<pre><code class="language-lua">-- ~/.essh/config_override.lua
for _, h in pairs(essh.select_hosts():get()) do
    if h.ForwardAgent == nil then
        h.ForwardAgent = &quot;yes&quot;
    end
end
</code></pre>

<p>上記の例では、すべてのホストにデフォルト値が設定されます。選択したホストに値を設定したい場合は、次のコードを使います:</p>

<pre><code class="language-lua">-- ~/.essh/config_override.lua
-- Getting only the hosts that has `web` tag or name of the hosts is `web`.
for _, h in pairs(essh.select_hosts(&quot;web&quot;):get()) do
    if h.ForwardAgent == nil then
        h.ForwardAgent = &quot;yes&quot;
    end
end

-- Using a table, Getting the hosts both `web` or `db`
for _, h in pairs(essh.select_hosts({&quot;web&quot;, &quot;db&quot;}):get()) do
    if h.ForwardAgent == nil then
        h.ForwardAgent = &quot;yes&quot;
    end
end

-- You can set a filter.
-- Getting only the `web` hosts filtered by `production`.
for _, h in pairs(essh.select_hosts(&quot;web&quot;):filter(&quot;production&quot;):get()) do
    if h.ForwardAgent == nil then
        h.ForwardAgent = &quot;yes&quot;
    end
end

-- Getting only the first one host using `first` method.
local h = essh.select_hosts(&quot;web&quot;):first()
if h.ForwardAgent == nil then
    h.ForwardAgent = &quot;yes&quot;
end
</code></pre></li>

<li><p><code>host</code> (function): <code>host</code> 関数のエイリアス。</p></li>

<li><p><code>task</code> (function): <code>task</code> 関数のエイリアス。</p></li>

<li><p><code>driver</code> (function): <code>driver</code> 関数のエイリアス。</p></li>

<li><p><code>debug</code> (function): デバッグメッセージを出力します。デバッグメッセージは<code>--debug</code>オプションつきでEsshを実行したときに出力されます。</p>

<pre><code class="language-lua">essh.debug(&quot;foo&quot;)
</code></pre></li>
</ul>

          </section>
        </div>
        <div class="col-sm-3 col-sm-pull-9">
          <section class="side-menu">
<ul>
<li><a href="index.html">ドキュメント</a></li>
<li><a href="configuration-files.html">設定ファイル</a></li>
<li><a href="hosts.html">ホスト</a></li>
<li><a href="tasks.html">タスク</a></li>
<li><a href="lua-vm.html">Lua VM</a></li>
<li><a href="cli-options.html">CLIオプション</a></li>
<li><a href="drivers.html">ドライバ</a></li>
<li><a href="groups.html">グループ</a></li>
<li><a href="integrating-other-tools.html">他のツールとの統合</a></li>
</ul>
</section>

        </div>

      </div>
    </div>
  </section>
  <footer>
  <div class="container">
    <p>Copyright (c) 2016 Kohki Makimoto</p>
    <ul class="list-inline">
      <li>
        <a href="https://github.com/kohkimakimoto/essh">Github</a>
      </li>
      <li>
        <a href="https://github.com/kohkimakimoto/essh/issues">Issues</a>
      </li>
      <li>
        <a href="https://github.com/kohkimakimoto/essh/releases">Releases</a>
      </li>
    </ul>
    <p>HTML template is <a href="https://github.com/BlackrockDigital/startbootstrap-new-age">startbootstrap-new-age</a> - Copyright 2013-2016 Blackrock Digital LLC.</p>
    <p>I use “Google Analytics” to collect information about use of this site.</p>
  </div>
</footer>

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/languages/lua.min.js"></script>
<script type="text/javascript" src="/essh/asciinema/asciinema-player.js"></script>
<script type="text/javascript" src="/essh/js/bundle.js"></script>



<script>hljs.initHighlightingOnLoad();</script>


</body>

</html>
