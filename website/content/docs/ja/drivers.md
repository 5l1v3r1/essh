+++
title = "ドライバ | ドキュメント"
type = "docs"
category = "docs"
lang = "ja"
basename = "drivers.html"
+++

# ドライバ

Drivers are templates to construct script in tasks execution.
If you don't specify the driver in the task configuration, Essh uses default built-in driver.

To understand what drivers do, see the following short example:

~~~lua
task "example" {
    script = {
        "echo aaa",
        "echo bbb",
    }
}
~~~

Try to run this task with `--debug` option to display the actual script.

~~~
$ essh example --debug
[essh debug] ...
[essh debug] real local command: [bash -c
export ESSH_TASK_NAME='example'
export ESSH_SSH_CONFIG=/var/folders/bt/xwh9qmcj00dctz53_rxclgtr0000gn/T/essh.ssh_config.544434412

echo aaa
echo bbb
]
~~~

According to the debug messages, the task ran the bash script:

~~~
export ESSH_TASK_NAME='example'
export ESSH_SSH_CONFIG=/var/folders/bt/xwh9qmcj00dctz53_rxclgtr0000gn/T/essh.ssh_config.544434412

echo aaa
echo bbb
~~~

This contents was generated by the **built-in driver**. The built-in driver is the following text template:

~~~go
{{template "environment" .}}
{{range $i, $script := .Scripts}}{{$script.code}}
{{end}}
~~~

`{{template "environment" .}}` generates environment variables section. In the above example, this section is

~~~
export ESSH_TASK_NAME='example'
export ESSH_SSH_CONFIG=/var/folders/bt/xwh9qmcj00dctz53_rxclgtr0000gn/T/essh.ssh_config.544434412
~~~

And after that, Essh concatenates `script` texts with new line code. In the above example,

~~~
echo aaa
echo bbb
~~~

Conclusion: Drivers are templates for outputting bash script.

## Custom Drivers

You can define and use your custom drivers using `driver` function.

Example:

~~~lua
driver "my_driver" {
    engine = [=[
        {{template "environment" .}}
        {{range $i, $script := .Scripts}}{{$script.code}}
        {{end}}
    ]=],
}

task "example" {
    driver = "my_driver",
    script = {
        "echo aaa",
        "echo bbb",
    }
}
~~~

`driver` configuration needs the required parameter `engine`. This is the template text.
To use you custom driver, you need to set task's `driver` property.

See more the example implementation:

[bash.driver](https://github.com/kohkimakimoto/essh/blob/master/modules/bash/index.lua)

or

[docker.driver](https://github.com/kohkimakimoto/essh/blob/master/modules/docker/index.lua)
